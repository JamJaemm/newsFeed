<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./main.css" />
    <title>축스피드</title>
  </head>
  <body>
    <header>
      <nav>
        <h1><a href="localhost:3018">축스피드</a></h1>
        <ul>
          <li><a href="#">Write</a></li>
          <li><a href="#">Sign Up</a></li>
          <li>
            <div>
              <input id="id" type="text" placeholder="ID 입력" />
              <input id="password" type="text" placeholder="PW 입력" />
              <button onclick="sign_in()">로그인</button>
              <button onclick="log_out()">로그아웃</button>
            </div>
          </li>
        </ul>
      </nav>
    </header>

    <div class="main-container">
      <main>
        <div class="btn-box">
          <button onclick="k_football()">국내축구</button>
          <button onclick="w_football()">해외축구</button>
          <button class="date-sort-btn" onclick="dateSort()">최신순</button>
        </div>
        <!-- 카테고리 표시 -->
        <p class="news-category">축구소식</p>
        <div class="news-box">
          <!-- template -->
          <!--  -->
        </div>
      </main>
    </div>
    <footer><p>NodeJs A반 6조 - 노드레인저</p></footer>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="api.js"></script>
    <script>
      $("document").ready(function () {
        getNews();
      });

      function getNews() {
        $.ajax({
          type: "GET",
          url: "/getnews",
          success: function (res) {
            const news = res.news;
            news.map((item) => {
              img = item.img;
              title = item.title;
              createdAt = item.createdAt.substring(0, 10);
              user = item.User.nickname;

              const template = `<ul>
                                  <li class="news-list">
                                    <div class="news-card">
                                      <a href="#"><img src="${img}" alt="#" /> 사진</a>
                                      <h3>${title}</h3>
                                      <p>${createdAt}</p>
                                      <p>${user}</p>
                                    </div>
                                  </li>
                                </ul>`;

              $(".news-category").html("축구소식");
              $(".news-box").append(template);
            });
          },
        });
      }

      // 로그인 버튼
      function sign_in() {
        let id = $("#id").val();
        let password = $("#password").val();
        console.log(id, password);
        $.ajax({
          type: "POST",
          url: "/login",
          data: {
            id: id,
            password: password,
          },
          success: function (response) {
            console.log("로그인 성공");
          },
          error: function (error) {
            console.log("로그인 실패");
          },
        });
      }

      // 로그아웃 버튼
      function log_out() {
        $.ajax({
          type: "POST",
          url: "/logout",
        });
      }

      // 국내축구 카테고리
      function k_football() {
        $(".news-box").empty();
        $.ajax({
          type: "GET",
          url: "/getnews",
          success: function (res) {
            const news = res.news;
            const newsList = news.filter((a) => {
              return a["category"] === "국내";
            });
            newsList.filter((item) => {
              img = item.img;
              title = item.title;
              createdAt = item.createdAt.substring(0, 10);
              user = item.User.nickname;

              const template = `<ul>
                                  <li class="news-list">
                                    <div class="news-card">
                                      <a href="#"><img src="${img}" alt="#" /> 사진</a>
                                      <h3>${title}</h3>
                                      <p>${createdAt}</p>
                                      <p>${user}</p>
                                    </div>
                                  </li>
                                </ul>`;

              $(".news-category").html(`${item.category}축구`);
              $(".news-box").append(template);
            });
          },
        });
      }

      // 해외축구 카테고리
      function w_football() {
        $(".news-box").empty();
        $.ajax({
          type: "GET",
          url: "/getnews",
          success: function (res) {
            const news = res.news;
            const newsList = news.filter((a) => {
              return a["category"] === "해외";
            });
            newsList.map((item) => {
              img = item.img;
              title = item.title;
              createdAt = item.createdAt.substring(0, 10);
              user = item.User.nickname;

              const template = `<ul>
                                  <li class="news-list">
                                    <div class="news-card">
                                      <a href="#"><img src="${img}" alt="#" /> 사진</a>
                                      <h3>${title}</h3>
                                      <p>${createdAt}</p>
                                      <p>${user}</p>
                                    </div>
                                  </li>
                                </ul>`;

              $(".news-category").html(`${item.category}축구`);
              $(".news-box").append(template);
            });
          },
        });
      }

      // 최신, 과거순 정렬 함수
      function dateSort() {
        $(".news-box").empty();

        // 정렬 버튼 텍스트
        let sortBtnText = $(".date-sort-btn").html();
        // 카테고리 텍스트
        let category = $(".news-category").html();

        // 과거순으로
        if (sortBtnText === "최신순") {
          if (category === "국내축구") {
            $.ajax({
              type: "GET",
              url: "/getoldnews",
              success: function (res) {
                const news = res.news;
                const newsList = news.filter((a) => {
                  return a["category"] === "국내";
                });
                newsList.map((item) => {
                  img = item.img;
                  title = item.title;
                  createdAt = item.createdAt.substring(0, 10);
                  user = item.User.nickname;

                  const template = `<ul>
                                  <li class="news-list">
                                    <div class="news-card">
                                      <a href="#"><img src="${img}" alt="#" /> 사진</a>
                                      <h3>${title}</h3>
                                      <p>${createdAt}</p>
                                      <p>${user}</p>
                                    </div>
                                  </li>
                                </ul>`;

                  $(".news-category").html(`${item.category}축구`);
                  $(".news-box").append(template);
                });
                $(".date-sort-btn").html("과거순");
              },
            });
          } else if (category === "해외축구") {
            $.ajax({
              type: "GET",
              url: "/getoldnews",
              success: function (res) {
                const news = res.news;
                const newsList = news.filter((a) => {
                  return a["category"] === "해외";
                });
                newsList.map((item) => {
                  img = item.img;
                  title = item.title;
                  createdAt = item.createdAt.substring(0, 10);
                  user = item.User.nickname;

                  const template = `<ul>
                                  <li class="news-list">
                                    <div class="news-card">
                                      <a href="#"><img src="${img}" alt="#" /> 사진</a>
                                      <h3>${title}</h3>
                                      <p>${createdAt}</p>
                                      <p>${user}</p>
                                    </div>
                                  </li>
                                </ul>`;

                  $(".news-category").html(`${item.category}축구`);
                  $(".news-box").append(template);
                });
                $(".date-sort-btn").html("과거순");
              },
            });
          } else {
            $.ajax({
              type: "GET",
              url: "/getoldnews",
              success: function (res) {
                const news = res.news;
                news.map((item) => {
                  img = item.img;
                  title = item.title;
                  createdAt = item.createdAt.substring(0, 10);
                  user = item.User.nickname;

                  const template = `<ul>
                                  <li class="news-list">
                                    <div class="news-card">
                                      <a href="#"><img src="${img}" alt="#" /> 사진</a>
                                      <h3>${title}</h3>
                                      <p>${createdAt}</p>
                                      <p>${user}</p>
                                    </div>
                                  </li>
                                </ul>`;

                  $(".news-category").html(`축구소식`);
                  $(".news-box").append(template);
                });
                $(".date-sort-btn").html("과거순");
              },
            });
          }
        }
        // 최신순으로
        else if (sortBtnText === "과거순") {
          if (category === "국내축구") {
            $.ajax({
              type: "GET",
              url: "/getnews",
              success: function (res) {
                const news = res.news;
                const newsList = news.filter((a) => {
                  return a["category"] === "국내";
                });
                newsList.map((item) => {
                  img = item.img;
                  title = item.title;
                  createdAt = item.createdAt.substring(0, 10);
                  user = item.User.nickname;

                  const template = `<ul>
                                  <li class="news-list">
                                    <div class="news-card">
                                      <a href="#"><img src="${img}" alt="#" /> 사진</a>
                                      <h3>${title}</h3>
                                      <p>${createdAt}</p>
                                      <p>${user}</p>
                                    </div>
                                  </li>
                                </ul>`;

                  $(".news-category").html(`${item.category}축구`);
                  $(".news-box").append(template);
                });
                $(".date-sort-btn").html("최신순");
              },
            });
          } else if (category === "해외축구") {
            $.ajax({
              type: "GET",
              url: "/getnews",
              success: function (res) {
                const news = res.news;
                const newsList = news.filter((a) => {
                  return a["category"] === "해외";
                });
                newsList.map((item) => {
                  img = item.img;
                  title = item.title;
                  createdAt = item.createdAt.substring(0, 10);
                  user = item.User.nickname;

                  const template = `<ul>
                                  <li class="news-list">
                                    <div class="news-card">
                                      <a href="#"><img src="${img}" alt="#" /> 사진</a>
                                      <h3>${title}</h3>
                                      <p>${createdAt}</p>
                                      <p>${user}</p>
                                    </div>
                                  </li>
                                </ul>`;

                  $(".news-category").html(`${item.category}축구`);
                  $(".news-box").append(template);
                });
                $(".date-sort-btn").html("최신순");
              },
            });
          } else {
            getNews();
            $(".date-sort-btn").html("최신순");
          }
        }
      }
    </script>
  </body>
</html>
